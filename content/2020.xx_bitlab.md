Title:HTB: Bitlab
Date: xx-xx-2020 12:30
category:security
tags:security, boot2root, HTB, gitlab
meta:security, boot2root, HTB, gitlab

<img class="align-left" src="/media/2020.xx/bitlab_card.png" alt="Bitlab Card" width="262">

This box is a writeup about a retired HacktheBox machine:
[Bitlab](https://www.hackthebox.eu/home/machines/profile/207).
This box is rated as a medium box. It implies 

<!-- PELICAN_END_SUMMARY -->

[TOC]

# Recon

Let us start as always by a `nmap` scan. Only the ports 22 (SSH) and 80 (HTTP)
are open:

    :::text
    # Nmap 7.80 scan initiated Mon Nov 25 13:23:49 2019 as: nmap -p- -oA nmap 10.10.10.114
    Nmap scan report for 10.10.10.114
    Host is up (0.099s latency).
    Not shown: 65533 filtered ports
    PORT   STATE SERVICE
    22/tcp open  ssh
    80/tcp open  http

    # Nmap done at Mon Nov 25 13:26:14 2019 -- 1 IP address (1 host up) scanned in 145.18 seconds

# Web

The home page is a [gitlab](https://about.gitlab.com/) home page.

We run a [dirb](https://tools.kali.org/web-applications/dirb) against the home
page and discover a few pages and directory.


```
-----------------
DIRB v2.22    
By The Dark Raver
-----------------

OUTPUT_FILE: dirb
START_TIME: Mon Nov 25 13:28:27 2019
URL_BASE: http://10.10.10.114/
WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt

-----------------

GENERATED WORDS: 4612

---- Scanning URL: http://10.10.10.114/ ----
+ http://10.10.10.114/explore (CODE:200|SIZE:13675)
+ http://10.10.10.114/favicon.ico (CODE:301|SIZE:169)
+ http://10.10.10.114/groups (CODE:302|SIZE:100)
==> DIRECTORY: http://10.10.10.114/help/
==> DIRECTORY: http://10.10.10.114/profile/
+ http://10.10.10.114/projects (CODE:302|SIZE:93)
+ http://10.10.10.114/public (CODE:200|SIZE:13755)
+ http://10.10.10.114/robots.txt (CODE:200|SIZE:2153)
+ http://10.10.10.114/root (CODE:200|SIZE:16026)
+ http://10.10.10.114/Root (CODE:302|SIZE:90)
+ http://10.10.10.114/search (CODE:200|SIZE:13366)
+ http://10.10.10.114/snippets (CODE:302|SIZE:102)
+ http://10.10.10.114/test (CODE:302|SIZE:91)

---- Entering directory: http://10.10.10.114/help/ ----
(!) WARNING: Directory IS LISTABLE. No need to scan it.
    (Use mode '-w' if you want to scan it anyway)

---- Entering directory: http://10.10.10.114/profile/ ----
+ http://10.10.10.114/profile/index.php (CODE:200|SIZE:4184)

-----------------
END_TIME: Mon Nov 25 13:44:24 2019
DOWNLOADED: 9224 - FOUND: 12
```

The `profile` URL give us access to some developer ugly profile:

![Clave profile](/media/2020.xx/bitlab_5.png)

When looking at the main page we can see an help link linking to a directory
listing page linking to a bookmarks page with a few bookmarks. 

![help link](/media/2020.xx/bitlab_1.png)
![Directory listing](/media/2020.xx/bitlab_2.png)
![Last bookmark](/media/2020.xx/bitlab_3.png)

The last link as the following value.

```
javascript:(function(){%20var%20_0x4b18=["\x76\x61\x6C\x75\x65","\x75\x73\x65\x72\x5F\x6C\x6F\x67\x69\x6E","\x67\x65\x74\x45\x6C\x65\x6D\x65\x6E\x74\x42\x79\x49\x64","\x63\x6C\x61\x76\x65","\x75\x73\x65\x72\x5F\x70\x61\x73\x73\x77\x6F\x72\x64","\x31\x31\x64\x65\x73\x30\x30\x38\x31\x78"];document[_0x4b18[2]](_0x4b18[1])[_0x4b18[0]]=%20_0x4b18[3];document[_0x4b18[2]](_0x4b18[4])[_0x4b18[0]]=%20_0x4b18[5];%20})()
```

We use an [online JavaScript Deobfuscator and Unpacker](https://lelinhtinh.github.io/de4js/)
to get the link "true" value:

```
javascript: (function () {
    % 20
    var % 20 _0x4b18 = ["value", "user_login", "getElementById", "clave", "user_password", "11des0081x"];
    document[_0x4b18[2]](_0x4b18[1])[_0x4b18[0]] = % 20 _0x4b18[3];
    document[_0x4b18[2]](_0x4b18[4])[_0x4b18[0]] = % 20 _0x4b18[5]; % 20
})()
```

The credentials "clave" and "11des0081x" allow us to connect to the gitlab. We
have access to two projects owned by the "administrator" user: "Profile" and
"Deployer".

![Connected user](/media/2020.xx/bitlab_4.png)

The first project is the developer profile seen earlier. The second project is
the code use to deploy the first project using the following PHP syntax:

    :::PHP
    if ($repo=='Profile' && $branch=='master' && $event=='merge_request' && $state=='merged') {
        echo shell_exec('cd ../profile/; sudo git pull'),"\n";
    }

The 
