Title:HTB: Resolutre
Date: 12-xx-2020 17:45
category:security
tags:security, boot2root, HTB,
meta:security, boot2root, HTB,

<img class="align-left" src="/media/2019.xx/resolute_card.png" alt="Resolute Card" width="262">

This box is a writeup about a retired HacktheBox machine:
[Wall](https://www.hackthebox.eu/home/machines/profile/208).
This box is rated as a medium box. It implies a lot of frustration, some
bruteforce, an centreon exploit with a WAF bypass and the exploitation of a SUID
`screen`.

<!-- PELICAN_END_SUMMARY -->

[TOC]

# User

## Recon

Let us start as always by a `nmap` scan.

    :::text
    nmap -p- -sS 10.10.10.169 -oA nmap
    Starting Nmap 7.80 ( https://nmap.org ) at 2019-12-10 09:49 EST
    Stats: 0:10:36 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan
    SYN Stealth Scan Timing: About 11.50% done; ETC: 11:22 (1:21:43 remaining)

    :::text
    # Nmap 7.80 scan initiated Tue Dec 10 10:00:33 2019 as: nmap -sS -oA nmap 10.10.10.169
    Nmap scan report for 10.10.10.169
    Host is up (0.24s latency).
    Not shown: 990 closed ports
    PORT     STATE SERVICE
    88/tcp   open  kerberos-sec
    135/tcp  open  msrpc
    139/tcp  open  netbios-ssn
    389/tcp  open  ldap
    445/tcp  open  microsoft-ds
    464/tcp  open  kpasswd5
    593/tcp  open  http-rpc-epmap
    636/tcp  open  ldapssl
    3268/tcp open  globalcatLDAP
    3269/tcp open  globalcatLDAPssl

    # Nmap done at Tue Dec 10 10:01:23 2019 -- 1 IP address (1 host up) scanned in 49.61 seconds

    :::text
    # Nmap 7.80 scan initiated Tue Dec 10 10:23:41 2019 as: nmap -sSV -p88,135,139,389,445,464,593,636,3268,3269 -oA service 10.10.10.169
    Nmap scan report for 10.10.10.169
    Host is up (0.21s latency).

    PORT     STATE SERVICE      VERSION
    88/tcp   open  kerberos-sec Microsoft Windows Kerberos (server time: 2019-12-10 15:31:50Z)
    135/tcp  open  msrpc        Microsoft Windows RPC
    139/tcp  open  netbios-ssn  Microsoft Windows netbios-ssn
    389/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: megabank.local, Site: Default-First-Site-Name)
    445/tcp  open  microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds (workgroup: MEGABANK)
    464/tcp  open  kpasswd5?
    593/tcp  open  ncacn_http   Microsoft Windows RPC over HTTP 1.0
    636/tcp  open  tcpwrapped
    3268/tcp open  ldap         Microsoft Windows Active Directory LDAP (Domain: megabank.local, Site: Default-First-Site-Name)
    3269/tcp open  tcpwrapped
    Service Info: Host: RESOLUTE; OS: Windows; CPE: cpe:/o:microsoft:windows

    Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
    # Nmap done at Tue Dec 10 10:24:10 2019 -- 1 IP address (1 host up) scanned in 28.98 seconds


    msf5 > use auxiliary/scanner/smb/smb_enumusers
    msf5 auxiliary(scanner/smb/smb_enumusers) > show options 

    Module options (auxiliary/scanner/smb/smb_enumusers):

      Name       Current Setting  Required  Description
      ----       ---------------  --------  -----------
      RHOSTS                      yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
      SMBDomain  .                no        The Windows domain to use for authentication
      SMBPass                     no        The password for the specified username
      SMBUser                     no        The username to authenticate as
      THREADS    1                yes       The number of concurrent threads (max one per host)

    msf5 auxiliary(scanner/smb/smb_enumusers) > set RHOSTS 10.10.10.169
    RHOSTS => 10.10.10.169
    msf5 auxiliary(scanner/smb/smb_enumusers) > run

    [+] 10.10.10.169:445      - MEGABANK [ Administrator, Guest, krbtgt, DefaultAccount, ryan, marko, sunita, abigail, marcus, sally, fred, angela, felicia, gustavo, ulf, stevie, claire, paulo, steve, annette, annika, per, claude, melanie, zach, simon, naoki ] ( LockoutTries=0 PasswordMin=7 )
    [*] 10.10.10.169:         - Scanned 1 of 1 hosts (100% complete)
    [*] Auxiliary module execution completed


msf5 auxiliary(scanner/smb/smb_ms17_010) > use auxiliary/scanner/smb/smb_lookupsid
msf5 auxiliary(scanner/smb/smb_lookupsid) > set RHOSTS 10.10.10.169
RHOSTS => 10.10.10.169
msf5 auxiliary(scanner/smb/smb_lookupsid) > run

[*] 10.10.10.169:445      - PIPE(LSARPC) LOCAL(MEGABANK - 5-21-1392959593-3013219662-3596683436) DOMAIN(MEGABANK - 5-21-1392959593-3013219662-3596683436)
[*] 10.10.10.169:445      - MEGABANK [ ]
[*] 10.10.10.169:         - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

